<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة الكاشير</title>
    
    <!-- Google Fonts - Tajawal -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- عنصر الرسائل - يجب أن يكون في الأعلى -->
    <div id="messageContainer"></div>

    <!-- صفحة تسجيل الدخول -->
    <div id="loginPage" class="page active">
        <div class="login-container">
            <div class="login-box">
                <div class="login-header">
                    <i class="fas fa-cash-register"></i>
                    <h1>نظام إدارة الكاشير</h1>
                    <p>New Mind POS Management System</p>
                </div>
                
                <form id="loginForm" class="login-form" onsubmit="event.preventDefault(); login();">
                    <div class="form-group">
                        <label for="username">اسم المستخدم</label>
                        <div class="input-group">
                            <i class="fas fa-user"></i>
                            <select id="username" name="username" required>
                                <option value="">اختر المستخدم</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="password">كلمة المرور</label>
                        <div class="input-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="password" name="password" required placeholder="أدخل كلمة المرور">
                            <button type="button" class="show-password" onclick="togglePasswordVisibility()">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i>
                        دخول
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>© 2025 نظام إدارة الكاشير - جميع الحقوق محفوظة</p>
                </div>
            </div>
        </div>
    </div>

    <!-- واجهة الكاشير -->
    <div id="cashierPage" class="page">
        <header class="main-header">
            <div class="header-content">
                <div class="header-info">
                    <h1><i class="fas fa-cash-register"></i> نظام إدارة الكاشير</h1>
                    <div class="user-info">
                        <span class="user-name">الكاشير: <span id="cashierNameDisplay">--</span></span>
                        <span class="current-date" id="currentDateCashier">--</span>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    خروج
                </button>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('categoriesTabCashier')">
                <i class="fas fa-tags"></i>
                التصنيفات
            </button>
            <button class="nav-tab" onclick="showTab('expensesTabCashier')">
                <i class="fas fa-receipt"></i>
                المصروفات
            </button>
            <button class="nav-tab" onclick="showTab('customersTabCashier')">
                <i class="fas fa-users"></i>
                العملاء
            </button>
            <button class="nav-tab" onclick="showTab('shiftCloseTabCashier')">
                <i class="fas fa-calculator"></i>
                تقفيل الشيفت
            </button>
        </nav>

        <main class="main-content">
            <!-- قسم التصنيفات (للكاشير) -->
            <div id="categoriesTabCashier" class="tab-content active">
                <div class="section-header">
                    <h2><i class="fas fa-tags"></i> إدارة التصنيفات</h2>
                    <button class="add-btn" onclick="showAddCategoryModal()">
                        <i class="fas fa-plus"></i>
                        إضافة تصنيف
                    </button>
                </div>
                
                <div class="categories-grid" id="categoriesGridCashier">
                    <!-- سيتم ملء التصنيفات ديناميكياً -->
                </div>
            </div>

            <!-- قسم المصروفات (للكاشير) -->
            <div id="expensesTabCashier" class="tab-content">
                <div class="section-header">
                    <h2><i class="fas fa-receipt"></i> إدارة المصروفات</h2>
                    <button class="add-btn" onclick="showAddExpenseModal()">
                        <i class="fas fa-plus"></i>
                        إضافة مصروف
                    </button>
                </div>
                
                <div class="expenses-filters">
                    <div class="filter-group">
                        <label for="expenseCategoryFilterCashier">التصنيف:</label>
                        <select id="expenseCategoryFilterCashier" onchange="filterCashierExpenses()">
                            <option value="">جميع التصنيفات</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="expenseDateFromFilterCashier">من تاريخ:</label>
                        <input type="date" id="expenseDateFromFilterCashier" onchange="filterCashierExpenses()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="expenseDateToFilterCashier">إلى تاريخ:</label>
                        <input type="date" id="expenseDateToFilterCashier" onchange="filterCashierExpenses()">
                    </div>
                    
                    <button class="clear-filters-btn" onclick="clearCashierExpenseFilters()">
                        <i class="fas fa-times"></i>
                        مسح الفلاتر
                    </button>
                </div>
                
                <div class="expenses-table">
                    <table id="expensesTableCashier">
                        <thead>
                            <tr>
                                <th>التصنيف</th>
                                <th>رقم الفاتورة</th>
                                <th>القيمة</th>
                                <th>التاريخ</th>
                                <th>الوقت</th>
                                <th>الملاحظات</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="expensesTableBodyCashier">
                            <!-- سيتم ملء البيانات ديناميكياً -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- قسم العملاء (للكاشير) -->
            <div id="customersTabCashier" class="tab-content">
                <div class="section-header">
                    <h2><i class="fas fa-users"></i> إدارة العملاء</h2>
                    <button class="add-btn" onclick="showAddCustomerModal()">
                        <i class="fas fa-plus"></i>
                        إضافة عميل
                    </button>
                </div>
                
                <div class="customers-table">
                    <table id="customersTableCashier">
                        <thead>
                            <tr>
                                <th>اسم العميل</th>
                                <th>رقم التليفون</th>
                                <th>إجمالي الأجل</th>
                                <th>تاريخ الإنشاء</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="customersTableBodyCashier">
                            <!-- سيتم ملء البيانات ديناميكياً -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- قسم تقفيل الشيفت (للكاشير) -->
            <div id="shiftCloseTabCashier" class="tab-content">
                <div class="section-header">
                    <h2><i class="fas fa-calculator"></i> تقفيل الشيفت</h2>
                </div>
                
                <div class="shift-close-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="shiftDateFromCashier">من تاريخ:</label>
                            <input type="date" id="shiftDateFromCashier" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="shiftDateToCashier">إلى تاريخ:</label>
                            <input type="date" id="shiftDateToCashier" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="shiftTimeFromCashier">من الساعة:</label>
                            <input type="time" id="shiftTimeFromCashier" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="shiftTimeToCashier">إلى الساعة:</label>
                            <input type="time" id="shiftTimeToCashier" required>
                        </div>
                    </div>
                    
                    <button type="button" class="calculate-btn" onclick="calculateCashierShift()">
                        <i class="fas fa-calculator"></i>
                        حساب الشيفت
                    </button>
                </div>
                
                <div class="shift-summary" id="shiftSummaryCashier" style="display: none;">
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h3>إجمالي المصروفات</h3>
                            <div class="summary-value" id="totalExpensesCashier">0</div>
                            <div class="summary-count">عدد الفواتير: <span id="expenseCountCashier">0</span></div>
                        </div>
                        
                        <div class="summary-card">
                            <h3>إجمالي الإنستا</h3>
                            <div class="summary-value" id="totalInstaCashier">0</div>
                            <div class="summary-count">عدد الفواتير: <span id="instaCountCashier">0</span></div>
                        </div>
                        
                        <div class="summary-card">
                            <h3>إجمالي الفيزا</h3>
                            <div class="summary-value" id="totalVisaCashier">0</div>
                            <div class="summary-count">عدد الفواتير: <span id="visaCountCashier">0</span></div>
                        </div>
                        
                        <div class="summary-card">
                            <h3>إجمالي الأونلاين</h3>
                            <div class="summary-value" id="totalOnlineCashier">0</div>
                            <div class="summary-count">عدد الفواتير: <span id="onlineCountCashier">0</span></div>
                        </div>
                        <!-- إضافة كارت المرتجعات هنا -->
                        <div class="summary-card">
                            <h3>إجمالي المرتجعات</h3>
                            <div class="summary-value" id="totalReturnsCashier">0</div>
                            <div class="summary-count">عدد الفواتير: <span id="returnsCountCashier">0</span></div>
                        </div>
                        
                        <div class="summary-card total">
                            <h3>الإجمالي الكلي (للمقارنة مع نيو مايند)</h3>
                            <div class="summary-value" id="grandTotalCashier">0</div>
                        </div>
                    </div>
                    
                    <div class="drawer-cash-section">
                        <div class="form-group">
                            <label for="drawerCashCashier">إجمالي نقدية الدرج:</label>
                            <input type="number" id="drawerCashCashier" placeholder="أدخل المبلغ النقدي في الدرج" step="0.01">
                        </div>
                        
                        <button type="button" class="close-shift-btn" onclick="finalizeCashierShiftCloseout()">
                            <i class="fas fa-check"></i>
                            تقفيل الشيفت
                        </button>
                    </div>
                </div>
                <!-- قسم عرض التقفيلات السابقة للكاشير -->
                <div id="cashierPreviousClosures" class="closures-history" style="display: none;">
                    <h3><i class="fas fa-history"></i> تقفيلاتك السابقة</h3>
                    <div class="closures-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>الفترة</th>
                                    <th>إجمالي الكاشير</th>
                                    <th>إجمالي نيو مايند</th>
                                    <th>الفرق</th>
                                    <th>الحالة</th>
                                    <th>تاريخ التقفيل</th>
                                    <th>الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="cashierClosuresHistoryBody">
                                <!-- سيتم ملء البيانات ديناميكياً -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

  <!-- واجهة المحاسب -->
<div id="accountantPage" class="page">
    <header class="main-header">
        <div class="header-content">
            <div class="header-info">
                <h1><i class="fas fa-chart-line"></i> لوحة تحكم المحاسب</h1>
                <div class="user-info">
                    <span class="user-name">المحاسب: <span id="accountantNameDisplay">--</span></span>
                    <span class="current-date" id="currentDateAccountant">--</span>
                </div>
            </div>
            <button type="button" class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                خروج
            </button>
        </div>
    </header>

    <nav class="nav-tabs">
        <button type="button" class="nav-tab active" onclick="showTab('dashboardTabAccountant')">
            <i class="fas fa-tachometer-alt"></i>
            الرئيسية
        </button>
        <button type="button" class="nav-tab" onclick="showTab('usersTabAccountant')">
            <i class="fas fa-users-cog"></i>
            المستخدمين
        </button>
        <button type="button" class="nav-tab" onclick="showTab('reportsTabAccountant')">
            <i class="fas fa-chart-bar"></i>
            التقارير
        </button>
        <button type="button" class="nav-tab" onclick="showTab('categoriesTabAccountant')">
            <i class="fas fa-tags"></i>
            التصنيفات
        </button>
        <button type="button" class="nav-tab" onclick="showTab('customersTabAccountant')">
            <i class="fas fa-users"></i>
            العملاء
        </button>
        <button type="button" class="nav-tab" onclick="showTab('shiftCloseTabAccountant')">
            <i class="fas fa-calculator"></i>
            تقفيل الشيفت
        </button>
        <!-- New Employees Tab -->
        <button type="button" class="nav-tab" onclick="showTab('employeesTabAccountant')">
            <i class="fas fa-user-tie"></i>
            الموظفين
        </button>
    </nav>

    <main class="main-content">
        <!-- لوحة التحكم الرئيسية للمحاسب -->
        <div id="dashboardTabAccountant" class="tab-content active">
            <div class="dashboard-stats">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي المصروفات (نقدي/عادي)</h3>
                            <div class="stat-value" id="totalNormalExpensesAccountant">0</div>
                            <div class="stat-period">عدد الفواتير: <span id="countNormalExpensesAccountant">0</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي الفيزا</h3>
                            <div class="stat-value" id="totalVisaAccountant">0</div>
                            <div class="stat-period">عدد الفواتير: <span id="countVisaAccountant">0</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي الإنستا</h3>
                            <div class="stat-value" id="totalInstaAccountant">0</div>
                            <div class="stat-period">عدد الفواتير: <span id="instaCountAccountant">0</span></div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي الأونلاين</h3>
                            <div class="stat-value" id="totalOnlineAccountant">0</div>
                            <div class="stat-period">عدد الفواتير: <span id="countOnlineAccountant">0</span></div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3>الكاشيرز</h3>
                            <div class="stat-value"><span id="totalActiveCashiersAccountant">0</span> / <span id="totalInactiveCashiersAccountant">0</span> / <span id="totalBlockedCashiersAccountant">0</span></div>
                            <div class="stat-period">نشط / موقوف / محظور</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-content">
                            <h3>العملاء</h3>
                            <div class="stat-value" id="totalCustomersAccountant">0</div>
                            <div class="stat-period">عليهم أجل: <span id="customersWithCreditAccountant">0</span> | إجمالي الأجل: <span id="totalCreditAmountAccountant">0</span> | حسابهم 0: <span id="customersWithZeroCreditAccountant">0</span></div>
                        </div>
                    </div>
                    <!-- في قسم إحصائيات المصروفات في لوحة تحكم المحاسب -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-undo-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3>إجمالي المرتجعات</h3>
                            <div class="stat-value" id="totalReturnsAccountant">0.00</div>
                            <div class="stat-period">عدد الفواتير: <span id="countReturnsAccountant">0</span></div>
                        </div>
                    </div>
                    <!-- New Employees Stats Card -->
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="stat-content">
                            <h3>الموظفين</h3>
                            <div class="stat-value" id="totalEmployeesAccountant">0</div>
                            <div class="stat-period">عليهم سلف: <span id="employeesWithAdvanceAccountant">0</span> | إجمالي السلف: <span id="totalAdvanceAmountAccountant">0</span> | سلفهم 0: <span id="employeesWithZeroAdvanceAccountant">0</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dashboard-filters">
                <div class="filter-group">
                    <label for="dashboardDateFromAccountant">من تاريخ:</label>
                    <input type="date" id="dashboardDateFromAccountant" onchange="updateAccountantDashboard()">
                </div>
                
                <div class="filter-group">
                    <label for="dashboardDateToAccountant">إلى تاريخ:</label>
                    <input type="date" id="dashboardDateToAccountant" onchange="updateAccountantDashboard()">
                </div>
                
                <div class="filter-group">
                    <label for="cashierFilterAccountant">الكاشير:</label>
                    <select id="cashierFilterAccountant" onchange="updateAccountantDashboard()">
                        <option value="">جميع الكاشيرز</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="searchInputAccountant">البحث عن فاتورة:</label>
                    <input type="text" id="searchInputAccountant" placeholder="رقم فاتورة" onchange="searchInvoiceAccountant()">
                </div>
                <button type="button" class="search-btn" onclick="searchInvoiceAccountant()">
                    <i class="fas fa-search"></i>
                    بحث
                </button>
            </div>
            <div id="invoiceSearchResultAccountant" class="report-content" style="display: none;"></div>
            
            <div class="cashiers-overview">
                <h3><i class="fas fa-users"></i> نظرة عامة على الكاشيرز</h3>
                <div class="cashiers-table">
                    <table>
                        <thead>
                            <tr>
                                <th>اسم الكاشير</th>
                                <th>إجمالي المصروفات (عادي)</th>
                                <th>عدد فواتير (عادي)</th>
                                <th>إجمالي الفيزا</th>
                                <th>عدد فواتير (فيزا)</th>
                                <th>إجمالي الإنستا</th>
                                <th>عدد فواتير (إنستا)</th>
                                <th>إجمالي الأونلاين</th>
                                <th>عدد فواتير (أونلاين)</th>
                                <th>إجمالي المرتجعات</th>
                                <th>عدد فواتير (مرتجعات)</th>
                                <th>آخر نشاط</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody id="cashiersOverviewBodyAccountant">
                            <!-- سيتم ملء البيانات ديناميكياً -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- قسم إدارة المستخدمين للمحاسب -->
        <div id="usersTabAccountant" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-users-cog"></i> إدارة المستخدمين</h2>
                <button type="button" class="add-btn" onclick="showAddUserModal()">
                    <i class="fas fa-plus"></i>
                    إضافة مستخدم
                </button>
            </div>
            
            <div class="users-table">
                <table>
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>رقم التليفون</th>
                            <th>اسم المستخدم</th>
                            <th>الدور</th>
                            <th>الحالة</th>
                            <th>تاريخ الإنشاء</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBodyAccountant">
                        <!-- سيتم ملء البيانات ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- قسم التقارير للمحاسب -->
        <div id="reportsTabAccountant" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-chart-bar"></i> التقارير</h2>
            </div>
            
            <div class="reports-filters">
                <div class="filter-group">
                    <label for="reportDateFromAccountant">من تاريخ:</label>
                    <input type="date" id="reportDateFromAccountant">
                </div>
                
                <div class="filter-group">
                    <label for="reportDateToAccountant">إلى تاريخ:</label>
                    <input type="date" id="reportDateToAccountant">
                </div>
                
                <div class="filter-group">
                    <label for="reportCashierAccountant">الكاشير:</label>
                    <select id="reportCashierAccountant">
                        <option value="">جميع الكاشيرز</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="reportCategoryAccountant">التصنيف:</label>
                    <select id="reportCategoryAccountant">
                        <option value="">جميع التصنيفات</option>
                    </select>
                </div>
                
                <button type="button" class="generate-report-btn" onclick="generateAccountantReport()">
                    <i class="fas fa-chart-line"></i>
                    إنشاء التقرير
                </button>
            </div>
            
            <div class="report-actions">
                <button type="button" class="print-btn" onclick="printReport()">
                    <i class="fas fa-print"></i>
                    طباعة
                </button>
                
                <button type="button" class="whatsapp-btn" onclick="showWhatsAppModal()">
                    <i class="fab fa-whatsapp"></i>
                    إرسال واتساب
                </button>
            </div>
            
            <div class="report-content" id="reportContentAccountant">
                <!-- سيتم عرض التقرير هنا -->
            </div>
        </div>

        <!-- قسم التصنيفات للمحاسب -->
        <div id="categoriesTabAccountant" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-tags"></i> إدارة التصنيفات</h2>
                <button type="button" class="add-btn" onclick="showAddCategoryModal()">
                    <i class="fas fa-plus"></i>
                    إضافة تصنيف
                </button>
            </div>
            
            <div class="categories-grid" id="categoriesGridAccountant">
                <!-- سيتم ملء التصنيفات ديناميكياً -->
            </div>
        </div>

        <!-- قسم العملاء (للمحاسب) -->
        <div id="customersTabAccountant" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-users"></i> إدارة العملاء</h2>
                <button type="button" class="add-btn" onclick="showAddCustomerModal()">
                    <i class="fas fa-plus"></i>
                    إضافة عميل
                </button>
            </div>
            
            <div class="customers-table">
                <table id="customersTableAccountant">
                    <thead>
                        <tr>
                            <th>اسم العميل</th>
                            <th>رقم التليفون</th>
                            <th>إجمالي الأجل</th>
                            <th>تاريخ الإنشاء</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="customersTableBodyAccountant">
                        <!-- سيتم ملء البيانات ديناميكياً -->
                    </tbody>
                </table>
            </div>
            <!-- تفاصيل الأجل والسداد للعميل -->
            <div id="customerDetailsAccountant" class="report-content" style="display: none;">
                <h3>تفاصيل أجل العميل: <span id="customerDetailsName"></span></h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="customerPaymentAmount">مبلغ السداد:</label>
                        <input type="number" id="customerPaymentAmount" step="0.01" placeholder="أدخل مبلغ السداد">
                    </div>
                    <button type="button" class="save-btn" onclick="processCustomerPayment()">
                        <i class="fas fa-money-bill-wave"></i>
                        سداد الأجل
                    </button>
                </div>
                <table id="customerCreditHistoryTable">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>نوع الحركة</th>
                            <th>المبلغ</th>
                            <th>رقم الفاتورة/ملاحظات</th>
                            <th>الكاشير/المحاسب</th>
                        </tr>
                    </thead>
                    <tbody id="customerCreditHistoryBody">
                        <!-- سيتم ملء بيانات الأجل والسداد ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- قسم الموظفين (للمحاسب) - New Tab -->
        <div id="employeesTabAccountant" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-user-tie"></i> إدارة الموظفين</h2>
                <button type="button" class="add-btn" onclick="showAddEmployeeModal()">
                    <i class="fas fa-plus"></i>
                    إضافة موظف
                </button>
            </div>
            
            <div class="employees-table">
                <table id="employeesTableAccountant">
                    <thead>
                        <tr>
                            <th>اسم الموظف</th>
                            <th>رقم التليفون</th>
                            <th>إجمالي السلف</th>
                            <th>تاريخ الإنشاء</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="employeesTableBodyAccountant">
                        <!-- سيتم ملء البيانات ديناميكياً -->
                    </tbody>
                </table>
            </div>
            <!-- تفاصيل السلف والسداد للموظف -->
            <div id="employeeDetailsAccountant" class="report-content" style="display: none;">
                <h3>تفاصيل سلف الموظف: <span id="employeeDetailsName"></span></h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="employeePaymentAmount">مبلغ السداد:</label>
                        <input type="number" id="employeePaymentAmount" step="0.01" placeholder="أدخل مبلغ السداد">
                    </div>
                    <button type="button" class="save-btn" onclick="processEmployeePayment()">
                        <i class="fas fa-money-bill-wave"></i>
                        سداد السلفة
                    </button>
                </div>
                <table id="employeeAdvanceHistoryTable">
                    <thead>
                        <tr>
                            <th>التاريخ</th>
                            <th>نوع الحركة</th>
                            <th>المبلغ</th>
                            <th>الملاحظات</th>
                            <th>الكاشير/المحاسب</th>
                        </tr>
                    </thead>
                    <tbody id="employeeAdvanceHistoryBody">
                        <!-- سيتم ملء بيانات السلف والسداد ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- قسم تقفيل الشيفت للمحاسب -->
        <div id="shiftCloseTabAccountant" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-calculator"></i> تقفيل الشيفت</h2>
            </div>
            
            <div class="accountant-shift-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="selectedCashierAccountant">البحث عن الكاشير:</label>
                        <select id="selectedCashierAccountant" onchange="searchCashierClosuresAccountant()">
                            <option value="">اختر الكاشير</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="accountantShiftDateFrom">من تاريخ:</label>
                        <input type="date" id="accountantShiftDateFrom">
                    </div>
                    
                    <div class="form-group">
                        <label for="accountantShiftDateTo">إلى تاريخ:</label>
                        <input type="date" id="accountantShiftDateTo">
                    </div>
                    
                    <div class="form-group">
                        <label for="accountantShiftTimeFrom">من الساعة:</label>
                        <input type="time" id="accountantShiftTimeFrom">
                    </div>
                    
                    <div class="form-group">
                        <label for="accountantShiftTimeTo">إلى الساعة:</label>
                        <input type="time" id="accountantShiftTimeTo">
                    </div>
                </div>
                
                <button type="button" class="search-btn" onclick="searchCashierClosuresAccountant()">
                    <i class="fas fa-search"></i>
                    بحث
                </button>
            </div>
            
            <div class="closure-results" id="closureResultsAccountant" style="display: none;">
                <div class="closure-info">
                    <h3>نتائج البحث</h3>
                    <div class="closure-summary" id="closureSummaryAccountant">
                        <p>إجمالي المصروفات (عادي): <span id="accTotalNormalExpenses">0</span></p>
                        <p>إجمالي الفيزا: <span id="accTotalVisa">0</span></p>
                        <p>إجمالي الإنستا: <span id="accTotalInsta">0</span></p>
                        <p>إجمالي الأونلاين: <span id="accTotalOnline">0</span></p>
                        <p>إجمالي المرتجعات: <span id="accTotalReturns">0.00</span> (<span class="invoice-count" id="accReturnsCount">0 فاتورة</span>)</p>
                        <div class="form-group">
                            <label class="switch">
                                <input type="checkbox" id="deductReturnsAccountant" onchange="updateAccountantClosureDisplay()">
                                <span class="slider round"></span>
                            </label>
                            <label for="deductReturnsAccountant" style="display: inline-block; margin-right: 10px;">إضافة المرتجعات إلى الإجمالي</label>
                        </div>
                        <p>إجمالي الكاش في الدرج: <span id="accDrawerCash">0</span></p>
                        <p><strong>الإجمالي الكلي للكاشير: <span id="accGrandTotalCashier">0</span></strong></p>
                        <p id="accGrandTotalAfterReturnsContainer" style="display: none;"><strong>الإجمالي الكلي للكاشير بعد إضافة المرتجع: <span id="accGrandTotalAfterReturns">0.00</span></strong></p>
                    </div>
                    <div class="newmind-input">
                        <div class="form-group">
                            <label for="newmindTotalAccountant">إجمالي نيو مايند:</label>
                            <input type="number" id="newmindTotalAccountant" placeholder="أدخل إجمالي نظام نيو مايند" step="0.01" onkeyup="calculateDifferenceAccountant()">
                        </div>
                        
                        <button type="button" class="calculate-difference-btn" onclick="calculateDifferenceAccountant()">
                            <i class="fas fa-calculator"></i>
                            حساب الفرق
                        </button>
                    </div>
                    
                    <div class="difference-result" id="differenceResultAccountant" style="display: none;">
                        <!-- سيتم عرض نتيجة المقارنة هنا -->
                    </div>
                    
                    <button type="button" class="close-cashier-btn" onclick="closeCashierByAccountant()" style="display: none;">
                        <i class="fas fa-check"></i>
                        تقفيل الكاشير
                    </button>
                </div>
            </div>
            
            <div class="closures-history">
                <h3><i class="fas fa-history"></i> سجل التقفيلات</h3>
                <div class="closures-table">
                    <table>
                        <thead>
                            <tr>
                                <th>الكاشير</th>
                                <th>الفترة</th>
                                <th>إجمالي الكاشير</th>
                                <th>إجمالي نيو مايند</th>
                                <th>الفرق</th>
                                <th>الحالة</th>
                                <th>تاريخ التقفيل</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="closuresHistoryBodyAccountant">
                            <!-- سيتم ملء البيانات ديناميكياً -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>

    <!-- النوافذ المنبثقة -->
    <!-- نافذة إضافة تصنيف -->
    <div id="addCategoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addCategoryModalTitle"><i class="fas fa-plus"></i> إضافة تصنيف جديد</h3>
                <button type="button" class="close-btn" onclick="closeModal('addCategoryModal')">&times;</button>
            </div>
            <form id="addCategoryForm" onsubmit="event.preventDefault(); addCategory();">
                <div class="form-group">
                    <label for="categoryCode">كود التصنيف:</label>
                    <input type="text" id="categoryCode" required placeholder="مثال: BG001">
                </div>
                
                <div class="form-group">
                    <label for="categoryName">اسم التصنيف:</label>
                    <input type="text" id="categoryName" required placeholder="مثال: بقالة">
                </div>
                
                <div class="form-group">
                    <label for="formType">نوع الفورم:</label>
                    <select id="formType" required>
                        <option value="">اختر نوع الفورم</option>
                        <option value="عادي">عادي</option>
                        <option value="فيزا">فيزا</option>
                        <option value="شحن_تاب">شحن تاب</option>
                        <option value="شحن_كهربا">شحن كهربا</option>
                        <option value="بنزين">بنزين</option>
                        <option value="سلف">سلف</option>
                        <option value="دفعة_شركة">دفعة شركة</option>
                        <option value="عجوزات">عجوزات</option>
                        <option value="اجل">أجل</option>
                        <option value="اونلاين">أونلاين</option>
                        <option value="إنستا">إنستا</option>
                        <option value="مرتجع">مرتجع</option> <!-- إضافة نوع المرتجع -->
                        <option value="سلف_موظف">سلف موظف</option> <!-- إضافة نوع سلف الموظف -->
                    </select>
                </div>

                <!-- Custom Fields Section -->
                <div class="section-header" style="margin-top: 20px;">
                    <h4>الحقول المخصصة</h4>
                    <button type="button" class="add-btn" onclick="addCustomFieldToEditor()">
                        <i class="fas fa-plus"></i> إضافة حقل مخصص
                    </button>
                </div>
                <div id="customFieldsContainer" class="custom-fields-container">
                    <!-- Custom fields will be added here dynamically -->
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="save-btn" id="addCategoryModalSaveBtn">
                        <i class="fas fa-save"></i>
                        حفظ
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal('addCategoryModal')">
                        <i class="fas fa-times"></i>
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

        <!-- نافذة إضافة مصروف -->
    <div id="addExpenseModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="addExpenseModalTitle"><i class="fas fa-plus"></i> إضافة مصروف جديد</h3>
                <button type="button" class="close-btn" onclick="closeModal('addExpenseModal')">&times;</button>
            </div>
            <form id="addExpenseForm" onsubmit="event.preventDefault(); addExpense();">
                <div class="form-group">
                    <label for="expenseCategorySearch">البحث عن التصنيف:</label>
                    <div class="input-group">
                        <input type="text" id="expenseCategorySearch" placeholder="ابحث بالاسم أو الكود" onkeyup="searchExpenseCategories(this.value)" autocomplete="off">
                        <div id="expenseCategorySuggestions" class="suggestions"></div>
                    </div>
                    <input type="hidden" id="selectedExpenseCategoryCode">
                    <input type="hidden" id="selectedExpenseCategoryName">
                    <input type="hidden" id="selectedExpenseCategoryFormType">
                    <input type="hidden" id="selectedExpenseCategoryId"> <!-- إضافة حقل لـ ID التصنيف -->
                </div>
                
                <div id="dynamicExpenseForm">
                    <!-- سيتم إنشاء الفورم ديناميكياً حسب نوع التصنيف -->
                    <!-- هنا سيتم إضافة حقل رقم الفاتورة لـ "اجل" -->
                </div>

                <div class="form-group checkbox-group" style="margin-top: 15px;">
                    <input type="checkbox" id="pinExpenseFormToggle">
                    <label for="pinExpenseFormToggle">تثبيت الفورم بعد الحفظ (لإدخال مصروفات متعددة من نفس النوع)</label>
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="save-btn" id="addExpenseModalSaveBtn">
                        <i class="fas fa-save"></i>
                        حفظ
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal('addExpenseModal')">
                        <i class="fas fa-times"></i>
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- نافذة إضافة عميل -->
    <div id="addCustomerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addCustomerModalTitle"><i class="fas fa-plus"></i> إضافة عميل جديد</h3>
                <button type="button" class="close-btn" onclick="closeModal('addCustomerModal')">&times;</button>
            </div>
            <form id="addCustomerForm" onsubmit="event.preventDefault(); addCustomer();">
                <div class="form-group">
                    <label for="customerName">اسم العميل:</label>
                    <input type="text" id="customerName" required placeholder="أدخل اسم العميل">
                </div>
                
                <div class="form-group">
                    <label for="customerPhone">رقم التليفون:</label>
                    <input type="tel" id="customerPhone" required placeholder="أدخل رقم التليفون">
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="save-btn" id="addCustomerModalSaveBtn">
                        <i class="fas fa-save"></i>
                        حفظ
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal('addCustomerModal')">
                        <i class="fas fa-times"></i>
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة إضافة موظف - New Modal -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addEmployeeModalTitle"><i class="fas fa-plus"></i> إضافة موظف جديد</h3>
                <button type="button" class="close-btn" onclick="closeModal('addEmployeeModal')">&times;</button>
            </div>
            <form id="addEmployeeForm" onsubmit="event.preventDefault(); addEmployee();">
                <div class="form-group">
                    <label for="employeeName">اسم الموظف:</label>
                    <input type="text" id="employeeName" required placeholder="أدخل اسم الموظف">
                </div>
                
                <div class="form-group">
                    <label for="employeePhone">رقم التليفون:</label>
                    <input type="tel" id="employeePhone" required placeholder="أدخل رقم التليفون">
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="save-btn" id="addEmployeeModalSaveBtn">
                        <i class="fas fa-save"></i>
                        حفظ
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal('addEmployeeModal')">
                        <i class="fas fa-times"></i>
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة إضافة مستخدم -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class-header">
                <h3 id="addUserModalTitle"><i class="fas fa-plus"></i> إضافة مستخدم جديد</h3>
                <button type="button" class="close-btn" onclick="closeModal('addUserModal')">&times;</button>
            </div>
            <form id="addUserForm" onsubmit="event.preventDefault(); addUser();">
                <div class="form-group">
                    <label for="userName">الاسم:</label>
                    <input type="text" id="userName" required placeholder="أدخل اسم المستخدم">
                </div>
                
                <div class="form-group">
                    <label for="userPhone">رقم التليفون:</label>
                    <input type="tel" id="userPhone" required placeholder="أدخل رقم التليفون">
                </div>
                
                <div class="form-group">
                    <label for="userUsername">اسم المستخدم:</label>
                    <input type="text" id="userUsername" required placeholder="أدخل اسم المستخدم للدخول">
                </div>
                
                <div class="form-group">
                    <label for="userPassword">كلمة المرور:</label>
                    <input type="password" id="userPassword" required placeholder="أدخل كلمة المرور">
                </div>
                
                <div class="form-group">
                    <label for="userRole">الدور:</label>
                    <select id="userRole" required>
                        <option value="">اختر الدور</option>
                        <option value="كاشير">كاشير</option>
                        <option value="محاسب">محاسب</option>
                    </select>
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="save-btn" id="addUserModalSaveBtn">
                        <i class="fas fa-save"></i>
                        حفظ
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal('addUserModal')">
                        <i class="fas fa-times"></i>
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة تغيير كلمة المرور -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> تغيير كلمة المرور</h3>
                <button type="button" class="close-btn" onclick="closeModal('changePasswordModal')">&times;</button>
            </div>
            <form id="changePasswordForm" onsubmit="event.preventDefault();">
                <p>تغيير كلمة المرور للمستخدم: <strong><span id="changePasswordModalUserName"></span></strong></p>
                <div class="form-group">
                    <label for="newPassword">كلمة المرور الجديدة:</label>
                    <input type="password" id="newPassword" required placeholder="أدخل كلمة المرور الجديدة">
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">تأكيد كلمة المرور الجديدة:</label>
                    <input type="password" id="confirmNewPassword" required placeholder="أعد إدخال كلمة المرور الجديدة">
                </div>
                <div class="modal-actions">
                    <button type="button" class="save-btn" id="changePasswordModalSaveBtn">
                        <i class="fas fa-save"></i>
                        حفظ
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal('changePasswordModal')">
                        <i class="fas fa-times"></i>
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة إرسال واتساب -->
    <div id="whatsappModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fab fa-whatsapp"></i> إرسال التقرير عبر واتساب</h3>
                <button type="button" class="close-btn" onclick="closeModal('whatsappModal')">&times;</button>
            </div>
            <form id="whatsappForm" onsubmit="event.preventDefault(); sendReportViaWhatsApp();">
                <div class="form-group">
                    <label for="whatsappNumber">رقم الواتساب:</label>
                    <input type="tel" id="whatsappNumber" required placeholder="أدخل رقم الواتساب">
                </div>
                
                <div class="modal-actions">
                    <button type="submit" class="send-btn">
                        <i class="fab fa-whatsapp"></i>
                        إرسال
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal('whatsappModal')">
                        <i class="fas fa-times"></i>
                        إلغاء
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة تفاصيل التقفيلة العامة (يمكن استخدامها لعرض تفاصيل أي تقفيلة) -->
    <div id="genericDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> تفاصيل التقفيلة</h3>
                <button type="button" class="close-btn" onclick="closeModal('genericDetailsModal')">&times;</button>
            </div>
            <div class="modal-body" id="genericDetailsModalContent">
                <!-- سيتم ملء المحتوى هنا ديناميكياً -->
            </div>
            <div class="modal-actions">
                <button type="button" class="cancel-btn" onclick="closeModal('genericDetailsModal')">
                    <i class="fas fa-times"></i>
                    إغلاق
                </button>
            </div>
        </div>
    </div>

    <!-- نافذة تقفيل المحاسب (لعرض التفاصيل وإدخال إجمالي نيو مايند) -->
    <div id="accountantClosureDetailsModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-check-double"></i> تقفيل المحاسب للشيفت</h3>
                <button type="button" class="close-btn" onclick="closeModal('accountantClosureDetailsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <h4>بيانات الشيفت:</h4>
                <p><strong>الكاشير:</strong> <span id="accountantClosureModalCashierName"></span></p>
                <p><strong>الفترة:</strong> <span id="accountantClosureModalPeriod"></span></p>
                <p><strong>إجمالي المصروفات (عادي):</strong> <span id="accountantClosureModalTotalExpenses">0.00</span></p>
                <p><strong>إجمالي الإنستا:</strong> <span id="accountantClosureModalTotalInsta">0.00</span></p>
                <p><strong>إجمالي الفيزا:</strong> <span id="accountantClosureModalTotalVisa">0.00</span></p>
                <p><strong>إجمالي الأونلاين:</strong> <span id="accountantClosureModalTotalOnline">0.00</span></p>
                <p><strong>إجمالي المرتجعات:</strong> <span id="accountantClosureModalTotalReturns">0.00</span></p>
               <div class="form-group">
                    <label class="switch">
                        <input type="checkbox" id="accountantClosureModalDeductReturns" onchange="updateAccountantClosureDifference()">
                        <span class="slider round"></span>
                    </label>
                    <label for="accountantClosureModalDeductReturns" style="display: inline-block; margin-right: 10px;">إضافة المرتجعات إلى الإجمالي</label>
                </div>
                <p><strong>إجمالي الكاش في الدرج:</strong> <span id="accountantClosureModalDrawerCash">0.00</span></p>
                <p><strong>الإجمالي الكلي للكاشير:</strong> <span id="accountantClosureModalGrandTotal">0.00</span></p>
                <p id="accountantClosureModalGrandTotalAfterReturnsContainer" style="display: none;"><strong>الإجمالي الكلي للكاشير بعد إضافة المرتجع: <span id="accountantClosureModalGrandTotalAfterReturns">0.00</span></strong></p>
                <hr>

                <div class="form-group">
                    <label for="accountantClosureModalNewMindTotal">إجمالي نيو مايند:</label>
                    <input type="number" id="accountantClosureModalNewMindTotal" step="0.01" placeholder="أدخل إجمالي نظام نيو مايند" onkeyup="updateAccountantClosureDifference()">
                </div>
                
                <p><strong>الفرق:</strong> <span id="accountantClosureModalDifference">0.00</span></p>
                <p><strong>الحالة:</strong> <span id="accountantClosureModalStatus" class="status open">في انتظار الإدخال</span></p>
            </div>
            <div class="modal-actions">
                <button type="button" class="save-btn" id="saveAccountantClosureBtn" onclick="saveAccountantClosure()" disabled>
                    <i class="fas fa-check"></i>
                    حفظ التقفيل
                </button>
                <button type="button" class="cancel-btn" onclick="closeModal('accountantClosureDetailsModal')">
                    <i class="fas fa-times"></i>
                    إلغاء
                </button>
            </div>
        </div>
    </div>

    <!-- تراكب التحميل -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>جار التحميل...</p>
        </div>
    </div>

    <!-- تحميل ملفات إضافية -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <!-- تحميل الملفات -->
    <script src="script.js"></script>
</body>
</html>
